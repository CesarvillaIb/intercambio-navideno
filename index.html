<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Intercambio Navide√±o Familiar 2025</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
      background: radial-gradient(circle at top, #ffffff 0, #ffe6ec 25%, #5b0b12 70%, #050816 100%);
      color: #1f2933;
      overflow: hidden;
    }

    /* Fondo: nieve */
    .snow {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    .snow span {
      position: absolute;
      top: -10px;
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.9);
      animation: fall linear infinite;
      opacity: 0.8;
    }

    @keyframes fall {
      0% {
        transform: translateY(-10px);
      }
      100% {
        transform: translateY(110vh);
      }
    }

    .card {
      position: relative;
      z-index: 1;
      background: rgba(255, 255, 255, 0.96);
      border-radius: 24px;
      padding: 20px 18px;
      max-width: 420px;
      width: 100%;
      box-shadow: 0 18px 45px rgba(0, 0, 0, 0.4);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(248, 250, 252, 0.95);
    }

    /* Borde brillante extra para que luzca m√°s en celulares */
    .card::before {
      content: "";
      position: absolute;
      inset: -2px;
      border-radius: 26px;
      padding: 1px;
      background: linear-gradient(135deg, rgba(239,68,68,0.7), rgba(34,197,94,0.7));
      -webkit-mask:
        linear-gradient(#000 0 0) content-box,
        linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      opacity: 0.75;
      pointer-events: none;
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      font-size: 0.8rem;
      padding: 4px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, #b91c1c, #065f46);
      color: #fefce8;
      margin: 0 auto 10px;
    }

    .badge span {
      font-weight: 500;
    }

    h1 {
      font-size: 1.5rem;
      margin: 0 0 4px;
      text-align: center;
      color: #111827;
    }

    .tagline {
      font-size: 0.8rem;
      text-align: center;
      margin-top: -2px;
      margin-bottom: 10px;
      color: #6b7280;
    }

    .place {
      font-size: 0.78rem;
      text-align: center;
      margin-bottom: 12px;
      color: #374151;
      line-height: 1.4;
    }

    .place a {
      color: #16a34a;
      text-decoration: none;
      font-weight: 600;
    }

    .place a:hover {
      text-decoration: underline;
    }

    .subtitle {
      font-size: 0.9rem;
      text-align: center;
      margin-bottom: 16px;
      color: #4b5563;
    }

    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 6px;
      color: #111827;
    }

    select,
    button {
      width: 100%;
      border-radius: 999px;
      padding: 12px 14px;
      font-size: 0.95rem;
      outline: none;
    }

    select {
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      margin-bottom: 14px;
    }

    select:focus {
      border-color: #16a34a;
      box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.2);
    }

    button {
      border: none;
      background: linear-gradient(135deg, #b91c1c, #16a34a);
      color: #fefce8;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-top: 4px;
      transition: transform 0.08s ease, box-shadow 0.08s ease, filter 0.08s ease;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.25);
    }

    button:active {
      transform: scale(0.97) translateY(1px);
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
      filter: brightness(0.97);
    }

    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      box-shadow: none;
    }

    .result {
      margin-top: 18px;
      padding: 12px 14px;
      border-radius: 14px;
      background: #f1f5f9;
      font-size: 0.95rem;
      display: none;
      border: 1px dashed #9ca3af;
    }

    .result strong {
      color: #111827;
    }

    .note {
      margin-top: 10px;
      font-size: 0.78rem;
      color: #6b7280;
      text-align: center;
    }

    .footer {
      margin-top: 16px;
      font-size: 0.7rem;
      text-align: center;
      color: #9ca3af;
    }

    .creator {
      margin-top: 4px;
      font-size: 0.7rem;
      text-align: center;
      color: #7f8c9d;
    }

    .creator strong {
      font-weight: 600;
    }

    .error {
      margin-top: 10px;
      color: #b91c1c;
      font-size: 0.8rem;
      text-align: center;
    }

    /* Ajustes espec√≠ficos para tel√©fonos */
    @media (max-width: 600px) {
      body {
        align-items: flex-start;
        padding-top: 24px;
      }

      .card {
        border-radius: 24px;
        padding: 18px 14px 20px;
      }

      h1 {
        font-size: 1.35rem;
      }

      .result {
        font-size: 0.92rem;
      }

      select,
      button {
        font-size: 0.9rem;
        padding: 11px 12px;
      }
    }
  </style>
</head>
<body>
  <div class="snow" id="snow"></div>

  <div class="card">
    <div class="badge">
      üéÑ <span>Intercambio Navide√±o 2025</span>
    </div>

    <h1>Santa Secreto Familiar</h1>

    <p class="tagline">
      Familia Villa ¬∑ Unidos ¬∑ Tradici√≥n ¬∑ Buenos Momentos üéÅ
    </p>

    <p class="place">
      üìç <strong>Casa de Sergio Villa</strong><br>
      Calle Guam√∫chil #52 ¬∑ Colonia El Tizate ¬∑ Zapopan, Jalisco<br>
      <a href="https://maps.app.goo.gl/PkwVp3p2bp2CBwY8A" target="_blank">
        üëâ Ver ubicaci√≥n en Google Maps
      </a>
    </p>

    <p class="subtitle">
      Selecciona tu nombre para saber a qui√©n le vas a regalar.
    </p>

    <div>
      <label for="nameSelect">¬øQui√©n eres?</label>
      <select id="nameSelect">
        <option value="">-- Selecciona tu nombre --</option>
      </select>

      <button id="drawBtn">
        Ver a qui√©n le regalo üéÅ
      </button>

      <div id="result" class="result"></div>
      <div id="error" class="error"></div>

      <p class="note">
        üí° S√≥lo ver√°s el resultado de tu propio nombre.<br />
        No recargues la p√°gina para espiar, conf√≠a en la magia navide√±a üòú
      </p>
    </div>

    <div class="footer">
      Intercambio navide√±o familiar ¬∑ 2025
    </div>

    <div class="creator">
      Creado por <strong>Paulo Cesar Villa Ibarra</strong>
    </div>
  </div>

  <script>
    const PARTICIPANTS = [
      "Sergio Villa",
      "Julia Ibarra",
      "Daniel Villa",
      "Oscar Padilla",
      "Mayra Villa",
      "Leonardo Mat√≠as",
      "Papa Chava",
      "Mama Tere",
      "Tania Villa",
      "Novio de Tania",
      "Mayte Villa",
      "Marichuy",
      "Omar Junior",
      "Fernanda Qui√±ones",
      "Beto"
    ];

    const SEED = "intercambio-navideno-familiar-2025";

    function xmur3(str) {
      let h = 1779033703 ^ str.length;
      for (let i = 0; i < str.length; i++) {
        h = Math.imul(h ^ str.charCodeAt(i), 3432918353);
        h = (h << 13) | (h >>> 19);
      }
      return function () {
        h = Math.imul(h ^ (h >>> 16), 2246822507);
        h = Math.imul(h ^ (h >>> 13), 3266489909);
        h ^= h >>> 16;
        return h >>> 0;
      };
    }

    function mulberry32(a) {
      return function () {
        let t = a += 0x6D2B79F5;
        t = Math.imul(t ^ (t >>> 15), t | 1);
        t = t ^ (t + Math.imul(t ^ (t >>> 7), t | 61));
        return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
      };
    }

    function seededShuffle(array, seedStr) {
      const seedFn = xmur3(seedStr);
      const rng = mulberry32(seedFn());
      const a = array.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(rng() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function generateDerangement(names, seedStr, maxTries = 1000) {
      for (let attempt = 0; attempt < maxTries; attempt++) {
        const shuffled = seededShuffle(names, seedStr + "#" + attempt);
        let valid = true;
        for (let i = 0; i < names.length; i++) {
          if (names[i] === shuffled[i]) {
            valid = false;
            break;
          }
        }
        if (valid) return shuffled;
      }
      throw new Error("No se pudo generar un sorteo v√°lido. Revisa la lista de participantes.");
    }

    function buildAssignmentMap(names, seedStr) {
      if (names.length < 2) {
        throw new Error("Se necesitan al menos 2 participantes.");
      }
      const derangement = generateDerangement(names, seedStr);
      const map = {};
      names.forEach((name, idx) => {
        map[name] = derangement[idx];
      });
      return map;
    }

    const nameSelect = document.getElementById("nameSelect");
    const drawBtn = document.getElementById("drawBtn");
    const resultBox = document.getElementById("result");
    const errorBox = document.getElementById("error");
    const snowContainer = document.getElementById("snow");

    let assignment = null;

    function initSnow() {
      const flakes = 60;
      for (let i = 0; i < flakes; i++) {
        const span = document.createElement("span");
        const size = Math.random() * 6 + 3;
        span.style.left = Math.random() * 100 + "vw";
        span.style.width = size + "px";
        span.style.height = size + "px";
        const duration = Math.random() * 10 + 8;
        const delay = Math.random() * -20;
        span.style.animationDuration = duration + "s";
        span.style.animationDelay = delay + "s";
        snowContainer.appendChild(span);
      }
    }

    function init() {
      PARTICIPANTS.forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        nameSelect.appendChild(opt);
      });

      try {
        assignment = buildAssignmentMap(PARTICIPANTS, SEED);
      } catch (err) {
        errorBox.textContent = err.message;
        drawBtn.disabled = true;
      }

      drawBtn.addEventListener("click", () => {
        errorBox.textContent = "";
        resultBox.style.display = "none";

        const selected = nameSelect.value;
        if (!selected) {
          errorBox.textContent = "Por favor, selecciona tu nombre.";
          return;
        }

        if (!assignment || !assignment[selected]) {
          errorBox.textContent = "Hubo un problema con el sorteo.";
          return;
        }

        const target = assignment[selected];
        resultBox.innerHTML = `
          üëã Hola, <strong>${selected}</strong><br/>
          T√∫ le vas a regalar a:<br/>
          üéÅ <strong>${target}</strong>
        `;
        resultBox.style.display = "block";
      });

      initSnow();
    }

    init();
  </script>
</body>
</html>
